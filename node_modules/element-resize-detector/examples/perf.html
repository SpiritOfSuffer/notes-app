<!DOCTYPE html>
<html>
<head>
    <style>
        html, body {
            height: 100%;
        }

        #aligner {
            height: 100%;
            display: flex;
        }

        .container {
            width: 20%;
            background: #FF9800;
            cursor: pointer;
            position: relative;
            border-right: 1px solid black;
            border-left: 1px solid black;
        }

        .container.elq-width-under-200 {
            height: 200px;
        }

        .container.elq-width-above-200 {
            height: 400px;
        }

        #dimensions {
            font-size: 3em;
            color: #FFF;
        }

        #dim-x, #dim-y {
            color: #263248;
        }

        .detect {
        	height: 100%;
        	padding: 5px;
        	background: rgba(255, 0, 0, 0.1);
        	pointer-events: none;
            width: 90%;
        }

    </style>
</head>
<body>
    <button onclick="resize()">Resize</button>
    <div id="aligner">
        <div class="detect">
            <div class="detect">
                <div class="detect">
                    <div class="detect">
                        <div class="detect">
                            <div class="detect">
                                <div class="detect">
                                    <div class="detect">

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="../build/element-resize-detector.js"></script>
    <script>var r="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global?global:this;function v(){r.Symbol||(r.Symbol=y);v=function(){}}var z=0;function y(t){return"jscomp_symbol_"+t+z++}(function(t){function A(a){a||(a=window.event);if(a=a.target||a.srcElement)a=a[l],a.f||(a.f=!0,p.push(a),u||(u=B(C)))}function C(){for(var a=0;a<p.length;++a){var b=p[a],c=b.g.parentNode;b.f=!1;b.h.scrollLeft=b.h.scrollTop=b.i.scrollLeft=b.i.scrollTop=999999;if(c){var e=c.offsetWidth,d=c.offsetHeight;if(b.c!==e||b.b!==d)for(c={width:e,height:d,c:b.c,b:b.b},b.c=e,b.b=d,e=0;e<b.a.length;++e)b.a[e].call(b.g.parentNode,c)}}p.length=0;u=null}function w(a){if(a[l])return a[l];for(var b=0;b<a.childNodes.length;++b){var c=a.childNodes[b];if(c[l])return c[l]}return null}function q(a){return a&&"object"===typeof a&&"undefined"!==typeof a.length?a:[a]}v();v();var l="function"===typeof Symbol?Symbol("ResizeListener"):"__ResizeListener__",f="ResizeListener".replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()+"-element",u=null,p=[],B=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return window.setTimeout(a,16)},m=document.createElement(f),n=m.cloneNode(!0);m.style.cssText="position:absolute;top:0;left:0;z-index:-999999;visibility:hidden;overflow:hidden;width:100%;height:100%";n.style.cssText="position:absolute;top:0;left:0;z-index:-999999;visibility:hidden;overflow:hidden;width:999999px;height:999999px";var f=m.cloneNode(!0),x=m.cloneNode(!0),D=n.cloneNode(!0),n=n.cloneNode(!0);n.style.width=n.style.height="200%";m.appendChild(f);m.appendChild(x);f.appendChild(D);x.appendChild(n);f={add:function(a,b){a=q(a);b=q(b);for(var c=0;c<a.length;++c)for(var e=0;e<b.length;++e){var d=a[c],f=b[e],g=w(d);if(g)g.a.push(f);else{var g=m.cloneNode(!0),k=g.childNodes[0],h=g.childNodes[1];"static"===(d.currentStyle?d.currentStyle.position:window.getComputedStyle?window.getComputedStyle(d,null).getPropertyValue("position"):d.style.position)&&(d.style.position="relative");d.appendChild(g);g[l]=k[l]=h[l]={g:g,h:k,i:h,c:d.offsetWidth,b:d.offsetHeight,a:[f],f:!1};k.scrollLeft=k.scrollTop=h.scrollLeft=h.scrollTop=999999;k.onscroll=h.onscroll=A}}},remove:function(a,b){a=q(a);b=q(b);for(var c=0;c<a.length;++c)for(var e=0;e<b.length;++e)a:{var d=a[c],f=b[e],g=w(d);if(g){if(f){for(var k=g.a,h=0;h<k.length;++h)k[h]===f&&(k.splice(h,1),--h);if(k.length)break a}d.removeChild(g.g)}}}};"function"===typeof define&&define.j?define(f):"object"===typeof exports?module.l=f:t.ResizeListener=f})(this);</script>
    <script>
        var alignerWidth = 100;
        var cnt = 0;

        function resize() {
            if(alignerWidth === 100) {
                alignerWidth = 50;
            } else {
                alignerWidth = 100;
            }

            $("#aligner").width(alignerWidth + "%");

            console.time("resize");
        }

        $(function() {
            function onElementResize(element) {

                if(++cnt === numElements) {
                    cnt = 0;
                    console.timeEnd("resize");
                }
            }

            function createDiv(width) {
                var d = document.createElement("div");
                d.className = "container";
                d.style.width = width;
                return d;
            }

            function loopCreateAndAppend(numNested, create, target) {
                for(var i = 0; i < numNested; i++) {
                    var d = create();
                    target.appendChild(d);
                }

                return target;
            }

            var numElements = 8;
            // loopCreateAndAppend(numElements, createDiv.bind(null, numElements), document.getElementById("aligner"));

            (function listenToResize() {
                var erd = elementResizeDetectorMaker({
                    strategy: "scroll"
                });
                console.time("install");
                // ResizeListener.add($(".detect"), onElementResize);
                erd.listenTo({
                    callOnAdd: false,
                    onReady: function onReady() {
                        console.timeEnd("install");
                        console.log("ready");
                    }
                }, $(".detect"), onElementResize);
            })();
        });

    </script>
</body>
</html>
